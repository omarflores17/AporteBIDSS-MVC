@*
    For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
*@
@model ERPMVC.Models.Vendor
@{
    ViewData["Title"] = "Detalle de Proveedor";
}
@{ Layout = null;
    var messages = new Dictionary<string, string>() { { "custom", "Ingrese un valor correcto." },
{"required","Valor requerido" }
};
    var rules = new Dictionary<string, string>() { { "custom", "customFunction" } };
}

<script>
    function GetVendorId() {
        return { VendorId: $("#VendorId").val() }
    }

</script>

<div class="mt-3 m-l-5">
    <form id="frmvendor" kendo-validator="true" kendo-messages="messages"
          data-ajax="true"
          data-ajax-method="post"
          data-ajax-begin="SaveTax"
          class="validation-wizard wizard-circle">
        <div class="row">
            <div class="col-md-4" hidden>
                <div class="form-group">
                    <label asp-for="VendorId" class=" control-label" style="width:100%">Id Vendedores</label>
                    <input type="text" asp-for="VendorId" name="VendorId" class="form-control" disabled="disabled" style="width:100%" />
                    <span asp-validation-for="VendorId" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="RTN" class=" control-label" style="width:100%">RTN/Identidad</label>
                    <input type="text" asp-for="RTN" name="RTN" required data-required-msg="El RTN es requerido." class="form-control" style="width:100%" onKeyPress="return soloNumeros(event)" onchange="Completar(event)" />
                    <span asp-validation-for="RTN" class="text-danger"></span>
                    <span id="RTNAlert" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error"><span role="alert" class="k-icon k-i-warning"></span> Por favor completar el campo RTN/Identidad.</span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="IdEstado" class="control-label">Estado</label>
                    <kendo-dropdownlist name="IdEstado"
                                        for="@Model.IdEstado"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar Estado"
                                        datatextfield="NombreEstado"
                                        datavaluefield="IdEstado"
                                        required data-required-msg="El estado es requerido."
                                        style="width: 100%;">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("GetGrupoEstadoUno", "Estados")" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                    <span asp-validation-for="IdEstado" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="form-group">
                    <label asp-for="VendorName" class=" control-label" style="width:100%"></label>
                    <input asp-for="VendorName" name="VendorName" maxlength="50" required data-required-msg="El nombre del proveedor es requerido." class="form-control" autocomplete="off" style="width:100%" onkeypress="return soloLetrasYNumeros(event)" />
                    <span asp-validation-for="VendorName" class="text-danger k-invalid-msg" data-for="VendorName"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="VendorTypeId" class="control-label">Tipo de Proveedor</label>
                    <kendo-dropdownlist name="VendorTypeId"
                                        for="@Model.VendorTypeId"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar tipo de proveedor"
                                        datatextfield="VendorTypeName"
                                        required data-required-msg="El tipo proveedor es requerido."
                                        datavaluefield="VendorTypeId"
                                        style="width: 100%;">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("GetVendorType", "VendorType")" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                    <span asp-validation-for="VendorTypeId" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row" hidden>

            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="Identidad" class=" control-label" style="width:100%"></label>
                    <input type="text" asp-for="Identidad" id="Identidad" name="Identidad" maxlength="13" class="form-control" style="width:100%" onKeyPress="return soloNumeros(event)" />
                    <span asp-validation-for="Identidad" class="text-danger"></span>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-md-8">
                <div class="form-group">
                    <label asp-for="Address" class=" control-label" style="width:100%"></label>
                    <textarea type="text" id="Address" class="form-control" maxlength="150" onKeyPress="return CaracterCampoDireccion(event)" required data-required-msg="La dirección es requerido." style="width:100%;" rows="10" cols="40" asp-for="Address"></textarea>

                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="Email" class=" control-label" style="width:100%">Email</label>
                    <input type="email" asp-for="Email" name="Email" placeholder="nombre@ejemplo.com" maxlength="50" data-required-msg="El correo es requerido." required data-email-msg="Formato del Correo no valido" class="form-control" autocomplete="off" style="width:100%" />

                </div>
                <script>
                    function refreshdepartamento() {
                        $("#StateId").data("kendoDropDownList").dataSource.read();
                    }
                </script>
                <div class="form-group">
                    <label asp-for="CountryId" class="control-label">País</label>
                    <kendo-dropdownlist name="CountryId"
                                        for="@Model.CountryId"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar País"
                                        datatextfield="Name"
                                        onchange="refreshdepartamento();"
                                        datavaluefield="Id"
                                        required data-required-msg="El país es requerido."
                                        auto-bind="true"
                                        style="width: 100%;">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("Get", "Country")" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                    <span asp-validation-for="CountryId" class="text-danger"></span>
                </div>

                <script>
                    function GetCountryId() {

                        return { 'CountryId': $("#CountryId").val() }
                    }

                    function refreshmunicipio() {
                        $("#CityId").data("kendoDropDownList").dataSource.read();
                    }
                </script>
                <div class="form-group">
                    <label asp-for="StateId" class=" control-label" style="width:100%"></label>
                    <kendo-dropdownlist name="StateId"
                                        for="@Model.StateId"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar Departamento"
                                        auto-bind="true"
                                        onchange="refreshmunicipio();"
                                        required data-required-msg="El departamento es requerido."
                                        datatextfield="Name"
                                        datavaluefield="Id"
                                        style="width: 100%;">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("GetJson", "State")" data="GetCountryId" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                    <span asp-validation-for="StateId" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="Phone" class=" control-label" style="width:100%"></label>
                    <input type="text" asp-for="Phone" name="Phone" required data-required-msg="El teléfono es requerido." maxlength="15" class="form-control" style="width:100%" onchange="Completarphone(event)" onKeyPress="return soloNumeros(event)" />
                    <span asp-validation-for="Phone" class="text-danger"></span>
                    <span id="PhoneAlert" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error"><span role="alert" class="k-icon k-i-warning"></span> Por favor completar el campo teléfono.</span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="CurrencyId" class="control-label">Tipo de Moneda</label>
                    <kendo-dropdownlist name="CurrencyId"
                                        for="@Model.CurrencyId"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar tipo Moneda"
                                        datatextfield="CurrencyName"
                                        required data-required-msg="La moneda es requerido."
                                        datavaluefield="CurrencyId"
                                        style="width: 100%;" onchange="PrevenirCambios()">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("Get", "Currency")" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                    <span asp-validation-for="CurrencyId" class="text-danger"></span>
                </div>
            </div>
            <script>
                function GetStateId() {

                    return { 'StateId': $("#StateId").val() }
                }
            </script>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="CityId" class=" control-label" style="width:100%"></label>
                    <kendo-dropdownlist name="CityId"
                                        for="@Model.CityId"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar Ciudad"
                                        auto-bind="true"
                                        required data-required-msg="La ciudad es requerido."
                                        datatextfield="Name"
                                        datavaluefield="Id"
                                        style="width: 100%;">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("GetCityJson", "City")" data="GetStateId" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                    <span asp-validation-for="CityId" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8">
                <div class="form-group">
                    <label asp-for="ContactPerson" class=" control-label" style="width:100%"></label>
                    <input type="text" asp-for="ContactPerson" name="ContactPerson" maxlength="50" required data-required-msg="La persona/contacto es requerido." class="form-control" style="width:100%" onkeypress="return soloLetras(event)" />
                    <span asp-validation-for="ContactPerson" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="PhoneReferencetwo" class=" control-label" style="width:100%">Teléfono Contacto</label>
                    <input type="text" asp-for="PhoneReferencetwo" name="PhoneReferencetwo" maxlength="15" required data-required-msg="El teléfono/referencia es requerido." class="form-control" style="width:100%" onchange="CompleatarPhoneREferencetwo(event)" onKeyPress="return soloNumeros(event)" />
                    <span asp-validation-for="PhoneReferencetwo" class="text-danger"></span>
                    <span id="PhoneReferencetwoAlert" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error"><span role="alert" class="k-icon k-i-warning"></span> Por favor completar el campo teléfono contacto.</span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-8">
                <div class="form-group">
                    <label asp-for="CompanyReferenceone" class=" control-label" style="width:100%"></label>
                    <input type="text" asp-for="CompanyReferenceone" name="CompanyReferenceone" maxlength="50" class="form-control" required data-required-msg="El compañía/referencia es requerido." style="width:100%" onkeypress="return soloLetrasYNumeros(event)" />
                    <span asp-validation-for="CompanyReferenceone" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="PhoneReferenceone" class=" control-label" style="width:100%"></label>
                    <input type="text" asp-for="PhoneReferenceone" name="PhoneReferenceone" maxlength="15" class="form-control" required data-required-msg="El teléfono/referencia es requerido." style="width:100%" onchange="CompleatarPhoneREferenceone(event)" onKeyPress="return soloNumeros(event)" />
                    <span asp-validation-for="PhoneReferenceone" class="text-danger"></span>
                    <span id="PhoneReferenceoneAlert" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg field-validation-error"><span role="alert" class="k-icon k-i-warning"></span> Por favor completar el campo teléfono referencia.</span>
                </div>
            </div>
        </div>
        <div class="row">
            @*<div class="col-md-4">
                    <div class="form-group">
                        <label asp-for="QtyMin" class=" control-label" style="width:100%"></label>
                        <input type="text" asp-for="QtyMin" name="QtyMin" min="0" class="form-control" style="width:100%" onKeyPress="return soloNumeros(event)" />
                        <span asp-validation-for="QtyMin" class="text-danger"></span>
                    </div>
                </div>*@
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="QtyMonth" class="control-label" style="width:100%"></label>
                    <kendo-numerictextbox name="QtyMonth"
                                          format="n2"
                                          min="0"
                                          step="1"
                                          required data-required-msg="La cantidad mensual es requerido."
                                          style="width:100%"
                                          value="Model.QtyMonth" />
                    <span asp-validation-for="QtyMonth" class="text-danger"></span>
                </div>
            </div>
        </div>
        @*<div class="row" hidden>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="IdEstado" class="control-label">Estado</label>
                    <kendo-dropdownlist name="IdEstado"
                                        for="@Model.IdEstado"
                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                        option-label="Seleccionar Estado"
                                        required data-required-msg="El estado es requerido."
                                        datatextfield="NombreEstado"
                                        datavaluefield="IdEstado"
                                        style="width: 100%;" onchange="PrevenirCambios()">
                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                            <transport>
                                <read url="@Url.Action("GetGrupoEstadoUno", "Estados")" />
                            </transport>
                        </datasource>
                    </kendo-dropdownlist>
                </div>
            </div>
        </div>*@

        <div class="row" id="roat">
            <div class="col-md-12">
                <button id="btnVendor" type="button" onclick="SaveVendor();" class="btn btn-success">Guardar</button>
                <a asp-action="Index" id="btncerrar" class="btn btn-secondary">Cerrar</a>
            </div>

        </div>
    </form>
</div>
<style>
    #roat {
        float: right;
    }
</style>

<script>
    function Completar(e) {
        var rtn = $("#RTN").val()
        var contador = rtn.length
        if (contador == 0) {
            $("#RTNAlert").hide();
        }
        else {
            if (contador < 14 || rtn.indexOf("_") > -1 == true) {
                //alert('Por favor completar el campo RTN/Identidad')
                $("#RTNAlert").show();
            }
            else {
                $("#RTNAlert").hide();
            }
        }
        
    }
    function Completarphone(e) {
        var phone = $("#Phone").val()
        var telefono = phone.length
        if (telefono == 0) {
            $("#PhoneAlert").hide();
        }
        else {
            if (telefono < 14 || phone.indexOf("_") > -1 == true) {
                //alert('Por favor completar el campo teléfono')
                $("#PhoneAlert").show();
            }
            else {
                $("#PhoneAlert").hide();
            }
        }
        
    }

    function CompleatarPhoneREferencetwo(e) {
        var cadena = $("#PhoneReferencetwo").val()
        var cadenaLenght = cadena.lenght
        if (cadenaLenght == 0) {
            $("#PhoneReferencetwoAlert").hide();
        }
        else {
            if (cadenaLenght < 14 || cadena.indexOf("_") > -1 == true) {
                //alert('Por favor completar el campo telefono contacto')
                $("#PhoneReferencetwoAlert").show();
                //document.getElementById("btnVendor").disabled = true;
            }
            else {
                $("#PhoneReferencetwoAlert").hide();
            }
        }
    }

    function CompleatarPhoneREferenceone(e) {
        var cadena2 = $("#PhoneReferenceone").val()
        var cadenaLenght2 = cadena2.lenght
        if (cadenaLenght2 == 0) {
            $("#PhoneReferenceoneAlert").hide();
        }
        else {
            if (cadenaLenght2 < 14 || cadena2.indexOf("_") > -1 == true) {
                //alert('Por favor completar el campo telefono referencia')
                $("#PhoneReferenceoneAlert").show();
                //document.getElementById("btnVendor").disabled = true;
            }
            else {
                $("#PhoneReferenceoneAlert").hide();
            }
        }
    }
    //function addDashes(f) {
    //    f.value = f.value.replace(/\D/g, '');

    //    f.value = f.value.slice(0, 4) + "-" + f.value.slice(4, 8) + "-" + f.value.slice(7, 16);
    //}

    var changes = false;

    function PrevenirCambios() {
        changes = true;
    }
    function soloNumeros(e) {
        var key = window.Event ? e.which : e.keyCode
        return ((key >= 48 && key <= 57) || (key == 8))
    }
    function soloLetras(e) {
        key = e.keyCode || e.which;
        tecla = String.fromCharCode(key).toLowerCase();
        letras = " áéíóúabcdefghijklmnñopqrstuvwxyz";
        especiales = "8-37-39-46";

        tecla_especial = false
        for (var i in especiales) {
            if (key == especiales[i]) {
                tecla_especial = true;
                break;
            }
        }

        if (letras.indexOf(tecla) == -1 && !tecla_especial) {
            return false;
        }
    }
    function soloLetrasYNumeros(e) {
        key = e.keyCode || e.which;
        tecla = String.fromCharCode(key).toLowerCase();
        letras = " áéíóúabcdefghijklmnñopqrstuvwxyz0123456789";
        especiales = "8-37-39-46";

        tecla_especial = false
        for (var i in especiales) {
            if (key == especiales[i]) {
                tecla_especial = true;
                break;
            }
        }

        if (letras.indexOf(tecla) == -1 && !tecla_especial) {
            return false;
        }
    }
    function CaracterCampoDireccion(e) {
        key = e.keyCode || e.which;
        tecla = String.fromCharCode(key).toLowerCase();
        letras = " áéíóúabcdefghijklmnñopqrstuvwxyz0123456789.,#";
        especiales = "8-37-39-46";

        tecla_especial = false
        for (var i in especiales) {
            if (key == especiales[i]) {
                tecla_especial = true;
                break;
            }
        }

        if (letras.indexOf(tecla) == -1 && !tecla_especial) {
            return false;
        }
    }
    $(document).ready(function () {
        $("#RTN").kendoMaskedTextBox({
            mask: "0000-0000-000000"
        });
        $("#Phone").kendoMaskedTextBox({
            mask: "(000)0000-0000"
        });
        $("#PhoneReferenceone").kendoMaskedTextBox({
            mask: "(000)0000-0000"
        });
        $("#PhoneReferencetwo").kendoMaskedTextBox({
            mask: "(000)0000-0000"
        });

        $("#RTN").on('paste', function (e) {
            e.preventDefault();
        });

        var IdEstado = $("#IdEstado").data("kendoDropDownList");
        IdEstado.noData[0].innerText = "Datos no encontrados.";
        var StateId = $("#StateId").data("kendoDropDownList");
        StateId.noData[0].innerText = "Datos no encontrados.";
        var VendorTypeId = $("#VendorTypeId").data("kendoDropDownList");
        VendorTypeId.noData[0].innerText = "Datos no encontrados.";
        var CountryId = $("#CountryId").data("kendoDropDownList");
        CountryId.noData[0].innerText = "Datos no encontrados.";
        var CurrencyId = $("#CurrencyId").data("kendoDropDownList");
        CurrencyId.noData[0].innerText = "Datos no encontrados.";
        var CityId = $("#CityId").data("kendoDropDownList");
        CityId.noData[0].innerText = "Datos no encontrados.";

        $("#RTNAlert").hide();
        $("#PhoneAlert").hide();
        $("#PhoneReferencetwoAlert").hide();
        $("#PhoneReferenceoneAlert").hide();
    });


    document.addEventListener("input", function () {
        $("input[type='text']", 'form').each(function () {
            _id = $(this).attr("id");
            _value = document.getElementById(_id).value;
            document.getElementById(_id).value = _value.trimStart();
        });

    })
    document.addEventListener("textarea", function () {
        $("input[type='text']", 'form').each(function () {
            _id = $(this).attr("id");
            _value = document.getElementById(_id).value;
            document.getElementById(_id).value = _value.trimStart();
        });

    })

    $("#VendorName").on("change", function () {
        this.value = MaysPrimera(this.value);
    })
    
    $("#ContactPerson").on("change", function () {
        this.value = MaysPrimera(this.value);
    })

    $("#CompanyReferenceone").on("change", function () {
        this.value = MaysPrimera(this.value);
    })

    function MaysPrimera(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
</script>
