@model ERPMVC.DTO.FixedAssetGroupDTO

@{ Layout = null;
	var messages = new Dictionary<string, string>() { { "custom", "Ingrese un valor correcto." },
   // {"required","Valor requerido" }
};
	var rules = new Dictionary<string, string>() { { "custom", "customFunction" } };
}

<script>
    function customFunction(input) {

        if (input.attr('name') === "FixedAssetGroupId" && input.val() === "0") {
            return false;
        }
    }

     //$('#btnprueba').val("");
</script>

<div id="ModalFixedAssetGroup" class="modal fade" role="dialog" data-keyboard="false" data-backdrop="static">
	<!-- Modal content -->
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Grupo de Activos</h4>
                <button type="button" name="btnprueba" class="close"  onclick="CerrarModal()" data-dismiss="modal">&times;</button>

            </div>
			<div class="modal-body">
				<div class="row" id="validation">
					<div class="col-lg-12">
						<div class="card">
							<div class="card-body">
                                <form id="frmFixedAssetGroup" kendo-validator="true" kendo-messages="messages"
                                      data-ajax="true"
                                      data-ajax-method="post"
                                      data-ajax-begin="SaveFixedAssetGroup"
                                      class="validation-wizard wizard-circle">
                                    <div class="form-body">
                                        <div class="row">
                                            <div class="col-md-4" hidden>
                                                <div class="form-group">
                                                    <label asp-for="FixedAssetGroupId" class="control-label" style="min-width:100%"></label>
                                                    <input type="text" asp-for="FixedAssetGroupId" name="FixedAssetGroupId" class="form-control" disabled="disabled" style="width:100%" />
                                                    <span asp-validation-for="FixedAssetGroupId" class="text-danger"></span>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label asp-for="FixedAssetGroupName" class="control-label" style="min-width:100%"></label>
                                                    <input type="text" asp-for="FixedAssetGroupName" name="FixedAssetGroupName" class="form-control" onkeyup="this.value=Numeros(this.value)"
                                                           autocomplete="off" style="width:100%" maxlength="50" required data-required-msg="El nombre es requerido." />
                                                    <span asp-validation-for="FixedAssetGroupName" class="text-danger"></span>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label asp-for="FixedAssetGroupDescription" class="control-label" style="min-width:100%"></label>
                                                    <input type="text" asp-for="FixedAssetGroupDescription" name="FixedAssetGroupDescription" class="form-control" onkeyup="this.value=Numeros(this.value)"
                                                      autocomplete="off" maxlength="200" style="width:100%" required data-required-msg="La descripción es requerida." />
                                                     <span asp-validation-for="FixedAssetGroupDescription" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label asp-for="FixedGroupCode" class="control-label" style="min-width:100%"></label>
                                                   <input type="text" asp-for="FixedGroupCode" maxlength="20" name="FixedGroupCode" class="form-control" autocomplete="off" style="width:100%" required data-required-msg="El código del grupo es requerido." onkeyup="this.value=Numeros(this.value)"/>
                                                  <span asp-validation-for="FixedGroupCode" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label asp-for="IdEstado" class="control-label"></label>
                                                    <kendo-dropdownlist name="IdEstado"
                                                                        for="@Model.IdEstado"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccionar Estado"
                                                                        required
                                                                        data-required-msg="El estado es requerido."
                                                                        datatextfield="NombreEstado"
                                                                        datavaluefield="IdEstado"
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi" server-operation="true">
                                                            <transport>
                                                                <read url="@Url.Action("GetGrupoEstadoUno", "Estados")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="IdEstado" class="text-danger"></span>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button id="btnFixedAssetGroup" class="btn btn-success" type="button" onclick="SaveFixedAssetGroup()"> Guardar </button>
                                        <button type="button" class="btn btn-default" name="btnprueba" data-dismiss="modal"  onclick="CerrarModal()">Cerrar</button>

                                    </div>
                                </form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
    function Numeros(string) {//solo letras y numeros
        var out = '';
        //Se añaden las letras validas
        var filtro = 'abcdefghijklmnñopqrstuvwxyzABCDEFGHIJKLMNÑOPQRSTUVWXYZ1234567890áéíóú.()- "';//Caracteres validos



        for (var i = 0; i < string.length; i++)
            if (filtro.indexOf(string.charAt(i)) != -1)
                out += string.charAt(i);
        return out;
    }
    //cierra modal
    function CerrarModal() {
        if (changes) {
            swal({
                title: "Cerrar",
                text: "Los datos que aun no se han guardado del formulario se perderan ¿Desea Continuar? ",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Aceptar",
                cancelButtonText: "Cancelar"
                //closeOnConfirm: false
            }, function () {
                $('#ModalFixedAssetGroup').modal('hide');
            });
        } else {
            $('#ModalFixedAssetGroup').modal('hide');
        }
    }

    function RefrescarGrid() {
        var grid = $("#gridFixedAssetGroup").getKendoGrid();
        grid.dataSource.read();
    }


	function SaveFixedAssetGroup() {
		var notification = $("#notification").data("kendoNotification");
		var estado = $("#IdEstado").data("kendoDropDownList");

		var dataObject =
		{
			'FixedAssetGroupId': $("#FixedAssetGroupId").val() === "" ? "0" : $("#FixedAssetGroupId").val(),
			'FixedAssetGroupName': $("#FixedAssetGroupName").val(),
			'FixedAssetGroupDescription': $("#FixedAssetGroupDescription").val(),
			'FixedGroupCode': $("#FixedGroupCode").val(),
			'IdEstado': estado.value(),
			'Estado': estado.text(),
		};

		
		var validator = $("#frmFixedAssetGroup").data("kendoValidator");
		var status = $(".status");

		if (validator.validate()) {
			$.ajax({
				url: '@Url.Action("SaveFixedAssetGroup", "FixedAssetGroup")',
				method: 'POST',
				dataType: 'json',
				contentType: 'application/json',
				async: false,
				data: JSON.stringify(dataObject),
				success: function (data) {
                    swal("Grupo Activos Fijos", "Datos Guardados", "success");
					RefrescarGrid();
					$("#IdEstado").data("kendoDropDownList").value(-1);
					$('#ModalFixedAssetGroup').modal('hide');
				},
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    swal("Error", "Ya existe un grupo de activos fijos con ese nombre", "error");
					//notification.show({
					//	title: "Validación",
					//	message: textStatus + ": " + XMLHttpRequest.responseText
					//}, "error");
				}
			});
		} else {
			notification.show({
				title: "Validación",
				message: "Ingrese todos los datos en el formulario!"
			}, "error");
		}		

		$("#btnFixedAssetGroup").show();
		$("#btnFixedAssetGroup").prop("disabled", false);
	}
</script>