@model ERPMVC.Models.BoletaDeSalida

@{ Layout = null;
    var messages = new Dictionary<string, string>() { { "custom", "Ingrese un valor correcto." },
                                        {"required","Valor requerido" }
                                    };
    var rules = new Dictionary<string, string>() { { "custom", "customFunction" } };
}



<script>

    function customFunction(input) {

        if (input.attr('name') === "BranchId" && input.val() === "0") {
            return false;
        }

        if (input.attr('name') === "CurrencyId" && input.val() === "0") {
            return false;
        }

        if (input.attr('name') === "Quantity" && input.val() == 0) {
            return false;
        }

        if (input.attr('name') === "Largo" && input.val() == 0) {
            return false;
        }

        if (input.attr('name') === "UsedArea" && input.val() == 0) {
            return false;
        }

        if (input.attr('name') === "Ancho" && input.val() == 0) {
            return false;
        }

        if (input.attr('name') === "Alto" && input.val() == 0) {
            return false;
        }



        return true;
    }


    function closeCustomer() {
        $('#myModalBoletaDeSalida').find(':input').not(':submit').val('0');     
        $("#BranchId").data("kendoDropDownList").value(0);
        $("#CustomerId").data("kendoDropDownList").value(0);
        RefreshGridBoletaDeSalida();
        $("#myModalBoletaDeSalida").modal('hide');


       // $("#TypeId").data("kendoDropDownList").value(0);
          // $('#myModalBoletaDeSalida').find(':select').not(':submit').val('0');
     //   $("#ProductId").data("kendoDropDownList").value(0);
      
    }

    function RefreshGridBoletaDeSalida() {
        var grid = $("#gridBoletaDeSalida").getKendoGrid();
        grid.dataSource.read();
    }
</script>


<div id="myModalBoletaDeSalida" class="modal fade" style="min-width:100%" role="dialog">
    <div class="modal-dialog modal-lg" role="document">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" onclick="closeCustomer();">&times;</button>
                <h4 class="modal-title">Información Boleta de Salida</h4>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">

                                    <form id="frmBoletaDeSalida" kendo-validator="true" kendo-messages="messages" kendo-rules="rules"
                                          data-ajax="true"
                                          data-ajax-method="post"
                                          method="post" class="validation-wizard wizard-circle">


                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <script>
                                                         function valueMapper(options) {
                                                            $.ajax({
                                                                url: "@Url.Action("Orders_ValueMapper", "GoodsDelivered")",
                                                                data: convertValues(options.value),
                                                                success: function (data) {
                                                                    options.success(data);
                                                                }
                                                            });
                                                        }

                                                        function convertValues(value) {
                                                            var data = {};
                                                            value = $.isArray(value) ? value : [value];

                                                            for (var idx = 0; idx < value.length; idx++) {
                                                                data["values[" + idx + "]"] = value[idx];
                                                            }

                                                            return data;
                                                        }

                                                        function changesetearvalues() {
                                                            var dataObject = { 'GoodsDeliveredId' : $("#GoodsDeliveredId").val() };
                                                            var notification = $("#notification").data("kendoNotification");
                                                            var subproductid = 0;
                                                            $.ajax({
                                                                url: '@Url.Action("GetGoodsDeliveredById", "GoodsDelivered")',
                                                                method: 'POST',
                                                                datatype: "json",
                                                                contentType: 'application/json',
                                                                async: false,
                                                                data: JSON.stringify(dataObject),
                                                                success: function (data) {
                                                                    //console.log(data);
                                                                    $("#Placa").val(data.Placa);
                                                                    $("#Motorista").val(data.Name);
                                                                    $("#Marca").val(data.Marca);
                                                                    $("#Quantity").data("kendoNumericTextBox").value(data._GoodsDeliveredLine[0].QuantitySacos);
                                                                    $("#CustomerId").data("kendoDropDownList").value(data.CustomerId);
                                                                    $("#SubProductId").data("kendoDropDownList").dataSource.read();
                                                                    $("#UnitOfMeasureId").data("kendoDropDownList").value(data._GoodsDeliveredLine[0].UnitOfMeasureId);
                                                                    $("#BranchId").data("kendoDropDownList").value(data.BranchId);
                                                                    subproductid = data._GoodsDeliveredLine[0].SubProductId;
                                                                },
                                                                error: function (XMLHttpRequest, textStatus, errorThrown) {

                                                                    notification.show({
                                                                        title: "Validacion",
                                                                        message: textStatus + ": " + XMLHttpRequest.responseText
                                                                    }, "error");

                                                                }
                                                            });

                                                            $("#SubProductId").data("kendoDropDownList").value(subproductid);
                                                        }
                                                    </script>
                                                    <label asp-for="GoodsDeliveredId" class="  control-label" style="width:100%"></label>
                                                    @if (Model.GoodsDeliveredId == 0)
                                                    {
                                                    @(Html.Kendo().DropDownListFor(m => m.GoodsDeliveredId)
                                                                               //.Name("cbxBuscar")
                                                                               .Filter(Kendo.Mvc.UI.FilterType.Contains)
                                                                               .OptionLabel("Seleccione un comprobante de entrega")
                                                                               .DataTextField("CustomerName")
                                                                               .DataValueField("GoodsDeliveredId")
                                                                               .HtmlAttributes(new { style = "width:100%", required = (string)null })
                                                                               .Height(290)
                                                                               .Events(e =>
                                                                               {
                                                                                   e.Change("changesetearvalues");
                                                                                   // e.Filtering("applyFilterCustomer");
                                                                               })
                                                                               .AutoBind(true)
                                                                               .DataSource(source =>
                                                                               {
                                                                                   source.Ajax()
                                                                                   .PageSize(80)

                                                                                   .Read("Virtualization_Read", "GoodsDelivered");
                                                                               })
                                                                               .Virtual(v => v.ItemHeight(26).ValueMapper("valueMapper"))
                                                    )
                                                    }
                                                    else
                                                    {
                                                        <input type="text" asp-for="GoodsDeliveredId" class="form-control" style="min-width:100%" disabled />
                                                    }

                                                    <span asp-validation-for="GoodsDeliveredId" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <script>
                                                         function valueMapperAuthorization(options) {
                                                            $.ajax({
                                                                url: "@Url.Action("Orders_ValueMapper", "GoodsDeliveryAuthorization")",
                                                                data: convertValues(options.value),
                                                                success: function (data) {
                                                                    options.success(data);
                                                                }
                                                            });
                                                        }

                                                        function convertValues(value) {
                                                            var data = {};
                                                            value = $.isArray(value) ? value : [value];

                                                            for (var idx = 0; idx < value.length; idx++) {
                                                                data["values[" + idx + "]"] = value[idx];
                                                            }

                                                            return data;
                                                        }
                                                    </script>
                                                    <label asp-for="GoodsDeliveryAuthorizationId" class="  control-label" style="width:100%"></label>
                                                    @if (Model.GoodsDeliveredId == 0)
                                                    {
                                                        @(Html.Kendo().DropDownListFor(m => m.GoodsDeliveryAuthorizationId)
                                                                                                    //.Name("cbxBuscar")
                                                                                                    .Filter(Kendo.Mvc.UI.FilterType.Contains)
                                                                                                    .OptionLabel("Seleccione una autorización")
                                                                                                    .DataTextField("CustomerName")
                                                                                                    .DataValueField("GoodsDeliveryAuthorizationId")
                                                                                                    .HtmlAttributes(new { style = "width:100%", required = (string)null })
                                                                                                    .Height(290)
                                                                                                    .Events(e =>
                                                                                                    {
                                                                                                                                            // e.Change("changesetearvalues");
                                                                                                                                            // e.Filtering("applyFilterCustomer");
                                                                                                                                        })
                                                                                                    .AutoBind(true)
                                                                                                    .DataSource(source =>
                                                                                                    {
                                                                                                        source.Ajax()
                                                                                                        .PageSize(80)

                                                                                                        .Read("Virtualization_Read", "GoodsDeliveryAuthorization");
                                                                                                    })
                                                                                                    .Virtual(v => v.ItemHeight(26).ValueMapper("valueMapperAuthorization"))
                                                        )
                                                    }
                                                    else
                                                    {
                                                        <input type="text" asp-for="GoodsDeliveryAuthorizationId" style="min-width:100%" class="form-control" disabled />
                                                    }

                                                    <span asp-validation-for="GoodsDeliveryAuthorizationId" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label asp-for="BoletaDeSalidaId" class="  control-label" style="width:100%"></label>
                                                    <kendo-numerictextbox name="BoletaDeSalidaId"
                                                                          format="n"
                                                                          enable="false"
                                                                          min="0"
                                                                          style="width:100%"
                                                                          step="1"
                                                                          value="Model.BoletaDeSalidaId"></kendo-numerictextbox>

                                                    <span asp-validation-for="BoletaDeSalidaId" class="text-danger"></span>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label asp-for="DocumentDate" class=" control-label" style="width: 100%;"></label>
                                                    <kendo-datetimepicker name="DocumentDate"
                                                                          style="width: 100%;"
                                                                          format="dd/MM/yyyy hh:mm:ss"
                                                                          time-format="hh:mm:ss"
                                                                          data-val-required="La fecha es requerida"
                                                                          value="Model.DocumentDate"></kendo-datetimepicker>
                                                    <span asp-validation-for="DocumentDate" class="text-danger"></span>
                                                </div>
                                            </div>

                                        </div>


                                        <div class="row">
                                            <div class="col-md-4">
                                                <script>
                                                      function valueMapperWB(options) {
                                                          $.ajax({
                                                              url: "@Url.Action("Orders_ValueMapper", "Boleto_Ent")",
                                                              data: convertValuesWB(options.value),
                                                              success: function (data) {
                                                                  options.success(data);
                                                              }
                                                          });
                                                      }

                                                      function convertValuesWB(value) {
                                                          var data = {};

                                                          value = $.isArray(value) ? value : [value];

                                                          for (var idx = 0; idx < value.length; idx++) {
                                                              data["values[" + idx + "]"] = value[idx];
                                                          }

                                                          return data;
                                                    }

                                                    function CallPesaje() {
                                                        $("#WeightBallot").data("kendoNumericTextBox").value($("#WeightBallotddl").val());
                                                        $("#WeightBallot").data("kendoNumericTextBox").trigger('change');
                                                        GetBoletaPeso();
                                                    }
                                                </script>
                                                <label asp-for="WeightBallot" class="control-label" style="width: 100%;"></label>
                                                @(Html.Kendo().DropDownList()
                                                                           .Name("WeightBallotddl")
                                                                           .Filter(Kendo.Mvc.UI.FilterType.Contains)
                                                                           .OptionLabel("Buscar")
                                                                           .DataTextField("observa_e")
                                                                           .DataValueField("clave_e")
                                                                           .HtmlAttributes(new { style = "width:100%" })
                                                                           .Height(290)
                                                                           .Events(e =>
                                                                           {
                                                                               e.Change("CallPesaje");
                                                                                                               // e.Filtering("applyFilterCustomer");
                                                                                                           })
                                                                           .AutoBind(true)
                                                                           .DataSource(source =>
                                                                           {
                                                                               source.Ajax()
                                                                               .PageSize(80)

                                                                               .Read("Virtualization_Read", "Boleto_Ent");
                                                                           })
                                                                           .Virtual(v => v.ItemHeight(26).ValueMapper("valueMapperWB"))
                                                )

                                                <span asp-validation-for="SubProductId" class="text-danger"></span>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <script>
                                                    function GetBoletaPeso() {

                                                        var notification = $("#notification").data("kendoNotification");
                                                        var dataObject = { 'clave_e': $("#WeightBallot").val()};
                                                        $.ajax({
                                                            url: '@Url.Action("GetBoleto_EntById", "Boleto_Ent")',
                                                            method: 'GET',
                                                            datatype: "json",
                                                            contentType: 'application/json',
                                                            async: false,
                                                            data: dataObject,
                                                            success: function (result) {
                                                                //console.log('Restful API:');
                                                                // console.log(result);
                                                                var resultados = result;
                                                                var pesobruto = (result.Boleto_Sal.peso_n / 100);
                                                                setearvalor("QQPesoBruto", pesobruto);

                                                                var tarapolietileno = ($("#TotalSacosPolietileno").val() * 0.5)/100;
                                                                var tarayute = ($("#TotalSacosYute").val() * 1)/100;
                                                                var ts = tarapolietileno + tarayute;

                                                                setearvalor("Tara", ts);
                                                                setearvalor("QQPesoNeto", pesobruto - ts);

                                                                $("#Motorista").val(resultados.conductor);
                                                                $("#Placa").val(resultados.placas);


                                                                if (resultados.clave_e == 0) {
                                                                    //Web api local
                                                                    var urlbase = "http://localhost:9200/api/code"
                                                                    var dataObject2 = { 'id': $("#WeightBallot").val() };

                                                                    //$.get(urlbase + '/' + $("#WeightBallot").val(), function (responseText) {
                                                                    //    alert(responseText);
                                                                    //});

                                                                    $.ajax({
                                                                        url: urlbase,
                                                                        type: 'GET',
                                                                        method: 'GET',
                                                                        cache: 'true',
                                                                        dataType: 'jsonp',
                                                                        // contentType: 'application/json',
                                                                        data: dataObject2,
                                                                        async: false,
                                                                        success: function (json) {
                                                                            //  console.log(json);
                                                                            resultados = json;
                                                                            $.ajax({
                                                                                url: '@Url.Action("SaveBoleto_Ent", "Boleto_Ent")',
                                                                                type: 'POST',
                                                                                method: 'POST',
                                                                                dataType: 'json',
                                                                                // contentType: 'application/json',
                                                                                data: JSON.stringify(resultados),
                                                                                async: false,
                                                                                success: function (json) {
                                                                                    //  console.log(json);
                                                                                    //resultados = json;

                                                                                },
                                                                                error: function (parsedjson, textStatus, errorThrown) {

                                                                                    $('body').append(
                                                                                        "parsedJson status: " + parsedjson.status + '</br>' +
                                                                                        "errorStatus: " + textStatus + '</br>' +
                                                                                        "errorThrown: " + errorThrown);

                                                                                }
                                                                            });



                                                                        },
                                                                        error: function (parsedjson, textStatus, errorThrown) {

                                                                            $('body').append(
                                                                                "parsedJson status: " + parsedjson.status + '</br>' +
                                                                                "errorStatus: " + textStatus + '</br>' +
                                                                                "errorThrown: " + errorThrown);

                                                                        }
                                                                    });

                                                                }


                                                                if ($("#EsIngreso").val() == 1) {
                                                                    if (resultados.Boleto_Sal.peso_s > resultados.peso_e) {

                                                                        notification.show({
                                                                            title: "Validación",
                                                                            message: "La boleta de peso es una salida de mercancía"
                                                                        }, "error");

                                                                        return false;
                                                                    }
                                                                }
                                                                else if ($("#EsIngreso").val() == 0) {
                                                                    if (resultados.Boleto_Sal.peso_s < resultados.peso_e) {

                                                                        notification.show({
                                                                            title: "Validación",
                                                                            message: "La boleta de peso es una entrada de mercancía"
                                                                        }, "error");

                                                                        return false;
                                                                    }
                                                                }


                                                            },
                                                             error: function (XMLHttpRequest, textStatus, errorThrown) {
                                                                    alert(textStatus + ": " + XMLHttpRequest.responseText);
                                                              }
                                                         });
                                                    }
                                                    </script>
                                                    <label asp-for="WeightBallot" class="control-label" style="width:100%"></label>
                                                    <kendo-numerictextbox name="WeightBallot"
                                                                          format="n"
                                                                          required
                                                                          min="0"
                                                                          spinners="false"
                                                                          max="99999999"
                                                                          onchange="return GetBoletaPeso()"
                                                                          step="1"
                                                                          style="width: 100%;"
                                                                          value="Model.WeightBallot"></kendo-numerictextbox>
                                                    <span asp-validation-for="WeightBallot" class="text-danger"></span>
                                                </div>
                                            </div>

                                        </div>




                                        <div class="row">

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <script>
                                                        function GetSubProduct(e) {
                                                            hcustom = this.value();
                                                            // console.log(this.value());
                                                            //console.log(e);
                                                            $("#SubProductId").data("kendoDropDownList").dataSource.read();
                                                        }
                                                    </script>
                                                    <label asp-for="CustomerId" class="  control-label" style="width:100%"></label>

                                                    <kendo-dropdownlist name="CustomerId" for="@Model.CustomerId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccione el Cliente"
                                                                        on-change="GetSubProduct"
                                                                        required
                                                                        datatextfield="CustomerName"
                                                                        datavaluefield="CustomerId"
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi" page-size="20000">
                                                            <transport>
                                                                <read url="@Url.Action("GetCustomer", "Common")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="CustomerId" class="text-danger"></span>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <script>
                                                        function setsubproductname(e) {
                                                            // console.log(e);
                                                            var dataItem = e.dataItem;
                                                            if (dataItem != null)
                                                                $("#subproductname").val(dataItem.ProductName);
                                                        }

                                                        var hcustom = 0;
                                                        function GetProductTypeIdS() {
                                                            //debugger;
                                                            return {
                                                                'CustomerId': $("#CustomerId").val(),

                                                            }
                                                        }

                                                    </script>
                                                    <label asp-for="SubProductId" class="control-label" style="width:100%"></label>

                                                    <kendo-dropdownlist name="SubProductId" filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        for="SubProductId"
                                                                        option-label="Seleccione el Producto"
                                                                        datatextfield="ProductName"
                                                                        datavaluefield="SubproductId"
                                                                        required
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi">
                                                            <transport>
                                                                <read url="@Url.Action("GetSubProductoByTipoByCustomer", "SubProduct")" data="GetProductTypeIdS" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="SubProductId" class="text-danger"></span>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <script>

                                                        function FillWareHouse(e) {
                                                            //var WarehouseId = $("#WarehouseId").getkendoDropDownList();
                                                            //WarehouseId.dataSource.read();
                                                            //$("#SubProductId").data("kendoDropDownList").dataSource.read();
                                                            var dataItem = e.dataItem;
                                                            $("#warehousesetid").val(dataItem.BranchId);
                                                            $("#WarehouseId").data("kendoDropDownList").dataSource.read();

                                                        }


                                                    </script>

                                                    <input type="hidden" id="warehousesetid" />
                                                    <label asp-for="BranchId" class="control-label"></label>
                                                    <kendo-dropdownlist name="BranchId" for="BranchId" filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Seleccione Sucursal"
                                                                        datatextfield="BranchName"
                                                                        datavaluefield="BranchId"
                                                                        required
                                                                        auto-bind="true"
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi">
                                                            <transport>
                                                                <read url="@Url.Action("GetBranch", "Branch")" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="BranchId" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="Placa" class="control-label" style="width: 100%;"></label>
                                                    <input type="text" id="Placa" required class="form-control" style="min-width:100%;" asp-for="Placa" />
                                                </div>
                                            </div>



                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="Marca" class="control-label" style="width: 100%;"></label>
                                                    <input type="text" id="Marca" required class="form-control" style="min-width: 100%;" asp-for="Marca" />
                                                </div>
                                            </div>


                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="Motorista" class="control-label" style="width: 100%;"></label>
                                                    <input type="text" id="Motorista" required class="form-control" style="min-width: 100%;" asp-for="Motorista" />
                                                </div>
                                            </div>

                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label asp-for="Vigilante" class="control-label" style="width: 100%;"></label>
                                                    <input type="text" id="Vigilante" required class="form-control" style="min-width:100%;" asp-for="Vigilante" />
                                                </div>
                                            </div>
                                        </div>



                                        <div class="row">
                                            <script>
                                                function CalcularArea() {
                                                    var UsedArea = $("#Ancho").val() * $("#Alto").val() * $("#Largo").val();
                                                    var numeric = $("#UsedArea").data("kendoNumericTextBox");
                                                    numeric.value(UsedArea);
                                                    numeric.trigger('change');
                                                    //$("#UsedArea").val(UsedArea);
                                                }
                                            </script>


                                            <script>
                                                function GrupoConfiguracionCargado() {
                                                    return { Id: 7 };
                                                }
                                            </script>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="CargadoId" class="  control-label" style="width:100%"></label>

                                                    <kendo-dropdownlist name="CargadoId"
                                                                        for="CargadoId"
                                                                        filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        option-label="Select CargadoId"
                                                                        datatextfield="Nombre"
                                                                        datavaluefield="Id"
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi">
                                                            <transport>
                                                                <read url="@Url.Action("GetElementoByIdConfiguracion", "ElementoConfiguracion")" data="GrupoConfiguracionCargado" />
                                                            </transport>
                                                        </datasource>
                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="CargadoId" class="text-danger"></span>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="UnitOfMeasureId" class="control-label" style="width:100%"></label>
                                                    <kendo-dropdownlist name="UnitOfMeasureId" filter="Kendo.Mvc.UI.FilterType.Contains"
                                                                        id="UnitOfMeasureId"
                                                                        option-label="Seleccione la unidad de medida"
                                                                        for="UnitOfMeasureId"
                                                                        datatextfield="UnitOfMeasureName"
                                                                        datavaluefield="UnitOfMeasureId"
                                                                        auto-bind="true"
                                                                        required
                                                                        style="width: 100%;">
                                                        <datasource type="DataSourceTagHelperType.WebApi">
                                                            <transport>
                                                                <read url="@Url.Action("GetUnitOfMeasure", "UnitOfMeasure")" />
                                                            </transport>
                                                        </datasource>

                                                    </kendo-dropdownlist>
                                                    <span asp-validation-for="UnitOfMeasureId" class="text-danger"></span>
                                                </div>
                                            </div>


                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="Quantity" class="  control-label" style="width:100%"></label>
                                                    <kendo-numerictextbox name="Quantity"
                                                                          format="n2"
                                                                          required
                                                                          min="0"
                                                                          step="1"
                                                                          style="width:100%"
                                                                          value="Model.Quantity"></kendo-numerictextbox>
                                                    <span asp-validation-for="Quantity" class="text-danger"></span>
                                                </div>
                                            </div>
                                        </div>



                                    </form>

                                    <div class="row">
                                      
                                            <button id="btnSaveBoletaDeSalida" type="submit" class="form-control btn-miboton" onclick="SaveBoletaDeSalida(this);">Guardar</button>
                                      
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    function SaveBoletaDeSalida(e) {

        var notification = $("#notification").data("kendoNotification");
       // e.preventDefault();
        $("#btnSaveBoletaDeSalida").hide();
        $("#btnSaveBoletaDeSalida").prop("disabled", true);

        //var displayedData = $("#gridControlPalletsDetail").data().kendoGrid.dataSource.view();

        var dataObject = {                    
            'BoletaDeSalidaId': $("#BoletaDeSalidaId").val(),
            'GoodsDeliveredId': $("#GoodsDeliveredId").val(),
            'GoodsDeliveryAuthorizationId': $("#GoodsDeliveryAuthorizationId").val(),
            'Vigilante': $("#Vigilante").val(),
            'DocumentDate': $("#DocumentDate").getKendoDateTimePicker().value().toJSON(),
            'BranchId': $("#BranchId").val(),
            'BranchName': $("#BranchId").data("kendoDropDownList").text(),
            'CustomerId': $("#CustomerId").val(),
            'CustomerName': $("#CustomerId").data("kendoDropDownList").text(),
            'Placa': $("#Placa").val(),
            'Marca': $("#Marca").val(),
            'Motorista': $("#Motorista").val(),
            'CargadoId': $("#CargadoId").val(),
            'Cargadoname': $("#CargadoId").data("kendoDropDownList").text(),
            'SubProductId': $("#SubProductId").val(),
            'SubProductName': $("#SubProductId").data("kendoDropDownList").text(),
            'UnitOfMeasureId': $("#UnitOfMeasureId").val(),
            'UnitOfMeasureName': $("#UnitOfMeasureId").data("kendoDropDownList").text(),
            'Quantity': $("#Quantity").val(),       
            'WeightBallot': $("#WeightBallot").val(),
           
        }; 

        var validator = $("#frmBoletaDeSalida").data("kendoValidator");
        //var validator2 = $("#TotalesDocumento").data("kendoValidator");
        var status = $(".status");

       // if (displayedData.length > 0) {
            if (validator.validate()) {

                $.ajax({
                    url: '@Url.Action("SaveBoletaDeSalida", "BoletaDeSalida")',
                    method: 'POST',
                    datatype: "json",
                    //contentType: "application/x-www-form-urlencoded; charset=UTF-8", 
                    contentType: 'application/json',
                    async: false,
                    data: JSON.stringify( dataObject),
                    success: function (data) {

                        $.toast({
                            heading: 'Satisfactorio',
                            text: 'Datos guardados correctamente.',
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'success',
                            hideAfter: 7000,
                            stack: 6
                        });
                   
                        RefreshGridBoletaSalida();                        
                        //$('#myModalSalesOrder').modal('hide');

                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $("#btnSaveBoletaDeSalida").show();
                        $("#btnSaveBoletaDeSalida").prop("disabled", false);
                      
                        notification.show({
                            title: "Validacion",
                            message: textStatus + ": " + XMLHttpRequest.responseText
                        }, "error");

                    }
                });

            }
            else {
                $("#btnSaveBoletaDeSalida").show();
                $("#btnSaveBoletaDeSalida").prop("disabled", false);
            
            }
        //}
        //else {
        //    $("#btnSaveControlEstiba").show();
        //    $("#btnSaveControlEstiba").prop("disabled", false);
        //    notification.show({
        //        title: "Validacion",
        //        message: "Debe agregar los productos!"
        //    }, "error");
   
       // }


       
    }
</script>